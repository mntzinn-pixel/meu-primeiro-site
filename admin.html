<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Admin</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white}
.topbar{
background:#111827;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
font-size:18px;
}
.menuBtn{font-size:22px;cursor:pointer}
.sidebar{
position:fixed;
top:0;
left:-250px;
width:250px;
height:100%;
background:#111827;
padding:20px;
transition:0.3s;
z-index:1000;
}
.sidebar button{
width:100%;
padding:15px;
margin-bottom:10px;
background:#1f2937;
border:none;
color:white;
border-radius:8px;
font-size:16px;
}
.sidebar.active{left:0}
.content{padding:15px}
.card{
background:#1f2937;
padding:15px;
border-radius:10px;
margin-bottom:15px;
}
input,select{
width:100%;
padding:12px;
margin:6px 0;
background:#0f172a;
border:1px solid #374151;
color:white;
border-radius:6px;
font-size:16px;
}
button.primary{
background:#2563eb;
border:none;
padding:12px;
border-radius:8px;
color:white;
font-size:16px;
width:100%;
}
table{width:100%;font-size:14px}
th,td{padding:8px;border-bottom:1px solid #374151}
img{width:50px;height:50px;object-fit:cover;border-radius:6px}
.hidden{display:none}
.login{
max-width:350px;
margin:120px auto;
background:#1f2937;
padding:20px;
border-radius:10px;
}
.stat{
background:#1f2937;
padding:15px;
border-radius:10px;
margin-bottom:10px;
font-size:18px;
}
</style>
</head>
<body>

<div id="loginPage" class="login">
<h2>Login Admin</h2>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button class="primary" onclick="login()">Entrar</button>
</div>

<div id="app" class="hidden">

<div class="topbar">
<span class="menuBtn" onclick="toggleMenu()">‚ò∞</span>
<span>Painel Admin</span>
</div>

<div id="sidebar" class="sidebar">
<button onclick="mostrar('dashboard')">üìä Dashboard</button>
<button onclick="mostrar('produtos')">üì¶ Produtos</button>
<button onclick="mostrar('categorias')">üè∑ Categorias</button>
<button onclick="mostrar('pedidos')">üõí Pedidos</button>
<button onclick="logout()">üö™ Sair</button>
</div>

<div class="content">

<div id="dashboard" class="section">
<div class="stat">Produtos: <span id="totalProdutos">0</span></div>
<div class="stat">Categorias: <span id="totalCategorias">0</span></div>
<div class="stat">Pedidos: <span id="totalPedidos">0</span></div>
<div class="stat">Total Vendido: R$ <span id="totalVendido">0</span></div>
</div>

<div id="produtos" class="section hidden">
<div class="card">
<input id="pNome" placeholder="Nome">
<input id="pPreco" type="number" placeholder="Pre√ßo">
<input id="pEstoque" type="number" placeholder="Estoque">
<select id="pCategoria">
<option value="">Selecione categoria</option>
</select>
<input type="file" id="pImagem">
<button class="primary" onclick="salvarProduto()">Salvar Produto</button>
</div>

<table>
<tbody id="listaProdutos"></tbody>
</table>
</div>

<div id="categorias" class="section hidden">
<div class="card">
<input id="cNome" placeholder="Nome da categoria">
<button class="primary" onclick="salvarCategoria()">Salvar Categoria</button>
</div>
<ul id="listaCategorias"></ul>
</div>

<div id="pedidos" class="section hidden">
<table>
<tbody id="listaPedidos"></tbody>
</table>
</div>

</div>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyDAnBNdufwLlMW4bZHK0mUgncmIezNSMTg",
authDomain:"minha-loja-digital1.firebaseapp.com",
projectId:"minha-loja-digital1",
storageBucket:"minha-loja-digital1.appspot.com"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();
let editId=null;

auth.onAuthStateChanged(user=>{
if(user){
loginPage.classList.add("hidden");
app.classList.remove("hidden");
}else{
loginPage.classList.remove("hidden");
app.classList.add("hidden");
}
});

function login(){
auth.signInWithEmailAndPassword(email.value,senha.value)
.catch(e=>alert(e.message));
}
function logout(){auth.signOut();}
function toggleMenu(){sidebar.classList.toggle("active");}
function mostrar(sec){
document.querySelectorAll(".section").forEach(s=>s.classList.add("hidden"));
document.getElementById(sec).classList.remove("hidden");
sidebar.classList.remove("active");
}

/* DASHBOARD */
db.collection("produtos").onSnapshot(s=>totalProdutos.innerText=s.size);
db.collection("categorias").onSnapshot(s=>totalCategorias.innerText=s.size);
db.collection("vendas").onSnapshot(s=>{
totalPedidos.innerText=s.size;
let soma=0;
s.forEach(doc=>soma+=doc.data().total||0);
totalVendido.innerText=soma.toFixed(2);
});

/* CATEGORIAS */
function salvarCategoria(){
if(!cNome.value)return;
db.collection("categorias").add({nome:cNome.value});
cNome.value="";
}
db.collection("categorias").onSnapshot(s=>{
listaCategorias.innerHTML="";
pCategoria.innerHTML="<option value=''>Selecione categoria</option>";
s.forEach(doc=>{
let c=doc.data();
listaCategorias.innerHTML+=`<li>${c.nome}</li>`;
pCategoria.innerHTML+=`<option value="${c.nome}">${c.nome}</option>`;
});
});

/* PRODUTOS */
async function salvarProduto(){
if(!pNome.value||!pPreco.value||!pCategoria.value)return alert("Preencha tudo");

let url="";
if(pImagem.files[0]){
let file=pImagem.files[0];
let ref=storage.ref().child("produtos/"+Date.now()+"_"+file.name);
await ref.put(file);
url=await ref.getDownloadURL();
}

let dados={
nome:pNome.value,
preco:parseFloat(pPreco.value),
estoque:parseInt(pEstoque.value)||0,
categoria:pCategoria.value
};

if(url)dados.imagem=url;

if(editId){
await db.collection("produtos").doc(editId).update(dados);
editId=null;
}else{
await db.collection("produtos").add(dados);
}

pNome.value="";
pPreco.value="";
pEstoque.value="";
pImagem.value="";
pCategoria.value="";
}

db.collection("produtos").onSnapshot(s=>{
listaProdutos.innerHTML="";
s.forEach(doc=>{
let p=doc.data();
listaProdutos.innerHTML+=`
<tr>
<td>${p.imagem?`<img src="${p.imagem}">`:""}</td>
<td>${p.nome}<br>R$ ${p.preco}<br>${p.categoria}</td>
<td>
<button onclick="editar('${doc.id}','${p.nome}',${p.preco},${p.estoque||0},'${p.categoria}')" style="background:#16a34a;border:none;padding:6px;color:white;border-radius:6px">Editar</button>
<button onclick="db.collection('produtos').doc('${doc.id}').delete()" style="background:#dc2626;border:none;padding:6px;color:white;border-radius:6px">Excluir</button>
</td>
</tr>
`;
});
});

function editar(id,nome,preco,estoque,categoria){
editId=id;
pNome.value=nome;
pPreco.value=preco;
pEstoque.value=estoque;
pCategoria.value=categoria;
mostrar('produtos');
}

/* PEDIDOS */
db.collection("vendas").onSnapshot(s=>{
listaPedidos.innerHTML="";
s.forEach(doc=>{
let v=doc.data();
listaPedidos.innerHTML+=`
<tr>
<td>${v.cliente||"-"}<br>R$ ${v.total||0}<br>${v.data||"-"}</td>
</tr>
`;
});
});
</script>

</body>
</html>
