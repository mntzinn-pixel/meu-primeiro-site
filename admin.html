<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Admin</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white;font-size:14px}
.topbar{background:#111827;padding:12px;display:flex;justify-content:space-between;align-items:center;font-size:16px}
.menuBtn{font-size:20px;cursor:pointer}
.sidebar{position:fixed;top:0;left:-240px;width:220px;height:100%;background:#111827;padding:15px;transition:0.3s;z-index:1000}
.sidebar button{width:100%;padding:10px;margin-bottom:8px;background:#1f2937;border:none;color:white;border-radius:6px;font-size:14px}
.sidebar.active{left:0}
.content{padding:12px}
.card{background:#1f2937;padding:12px;border-radius:8px;margin-bottom:12px}
input,select{width:100%;padding:8px;margin:5px 0;background:#0f172a;border:1px solid #374151;color:white;border-radius:6px;font-size:14px}
button.primary{background:#2563eb;border:none;padding:10px;border-radius:6px;color:white;font-size:14px;width:100%}
table{width:100%;font-size:13px}
th,td{padding:6px;border-bottom:1px solid #374151}
img{width:45px;height:45px;object-fit:cover;border-radius:6px}
.hidden{display:none}
.login{max-width:300px;margin:100px auto;background:#1f2937;padding:18px;border-radius:8px}
.stat{background:#1f2937;padding:12px;border-radius:8px;margin-bottom:8px;font-size:15px}
</style>
</head>
<body>

<div id="loginPage" class="login">
<h2>Login Admin</h2>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button type="button" class="primary" id="btnLogin">Entrar</button>
</div>

<div id="app" class="hidden">

<div class="topbar">
<span class="menuBtn" id="menuBtn">‚ò∞</span>
<span>Painel Admin</span>
</div>

<div id="sidebar" class="sidebar">
<button id="btnDash">üìä Dashboard</button>
<button id="btnProd">üì¶ Produtos</button>
<button id="btnCat">üè∑ Categorias</button>
<button id="btnPed">üõí Pedidos</button>
<button id="btnLogout">üö™ Sair</button>
</div>

<div class="content">

<div id="dashboard" class="section">
<div class="stat">Produtos: <span id="totalProdutos">0</span></div>
<div class="stat">Categorias: <span id="totalCategorias">0</span></div>
<div class="stat">Pedidos: <span id="totalPedidos">0</span></div>
<div class="stat">Total Vendido: R$ <span id="totalVendido">0</span></div>
</div>

<div id="produtos" class="section hidden">
<div class="card">
<input id="pNome" placeholder="Nome">
<input id="pPreco" type="number" placeholder="Pre√ßo">
<input id="pEstoque" type="number" placeholder="Estoque">
<select id="pCategoria"></select>
<input type="file" id="pImagem">
<button type="button" class="primary" id="btnSalvarProduto">Salvar Produto</button>
</div>
<table><tbody id="listaProdutos"></tbody></table>
</div>

<div id="categorias" class="section hidden">
<div class="card">
<input id="cNome" placeholder="Nome da categoria">
<button type="button" class="primary" id="btnSalvarCategoria">Salvar Categoria</button>
</div>
<ul id="listaCategorias"></ul>
</div>

<div id="pedidos" class="section hidden">
<table><tbody id="listaPedidos"></tbody></table>
</div>

</div>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyDAnBNdufwLlMW4bZHK0mUgncmIezNSMTg",
authDomain:"minha-loja-digital1.firebaseapp.com",
projectId:"minha-loja-digital1",
storageBucket:"minha-loja-digital1.appspot.com"
};

firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();

let editId=null;

document.addEventListener("DOMContentLoaded",()=>{

const loginPage=document.getElementById("loginPage");
const app=document.getElementById("app");

const pNome=document.getElementById("pNome");
const pPreco=document.getElementById("pPreco");
const pEstoque=document.getElementById("pEstoque");
const pCategoria=document.getElementById("pCategoria");
const pImagem=document.getElementById("pImagem");
const cNome=document.getElementById("cNome");

document.getElementById("menuBtn").onclick=()=>sidebar.classList.toggle("active");
document.getElementById("btnDash").onclick=()=>mostrar("dashboard");
document.getElementById("btnProd").onclick=()=>mostrar("produtos");
document.getElementById("btnCat").onclick=()=>mostrar("categorias");
document.getElementById("btnPed").onclick=()=>mostrar("pedidos");
document.getElementById("btnLogout").onclick=()=>auth.signOut();
document.getElementById("btnLogin").onclick=()=>{
auth.signInWithEmailAndPassword(
document.getElementById("email").value,
document.getElementById("senha").value
).catch(e=>alert(e.message));
};

function mostrar(sec){
document.querySelectorAll(".section").forEach(s=>s.classList.add("hidden"));
document.getElementById(sec).classList.remove("hidden");
sidebar.classList.remove("active");
}

auth.onAuthStateChanged(user=>{
if(user){
loginPage.classList.add("hidden");
app.classList.remove("hidden");
}
});

document.getElementById("btnSalvarCategoria").onclick=()=>{
if(!cNome.value)return;
db.collection("categorias").add({nome:cNome.value});
cNome.value="";
};

db.collection("categorias").onSnapshot(s=>{
pCategoria.innerHTML="<option value=''>Selecione categoria</option>";
document.getElementById("listaCategorias").innerHTML="";
s.forEach(doc=>{
let c=doc.data();
pCategoria.innerHTML+=`<option value="${c.nome}">${c.nome}</option>`;
listaCategorias.innerHTML+=`<li>${c.nome}</li>`;
});
});

document.getElementById("btnSalvarProduto").onclick=async ()=>{
if(!pNome.value||!pPreco.value||!pCategoria.value){
alert("Preencha tudo");
return;
}

let url="";
if(pImagem.files.length>0){
let file=pImagem.files[0];
let ref=storage.ref().child("produtos/"+Date.now()+"_"+file.name);
await ref.put(file);
url=await ref.getDownloadURL();
}

let dados={
nome:pNome.value,
preco:parseFloat(pPreco.value),
estoque:parseInt(pEstoque.value)||0,
categoria:pCategoria.value
};
if(url)dados.imagem=url;

if(editId){
await db.collection("produtos").doc(editId).update(dados);
editId=null;
alert("Atualizado!");
}else{
await db.collection("produtos").add(dados);
alert("Salvo!");
}

pNome.value="";
pPreco.value="";
pEstoque.value="";
pImagem.value="";
pCategoria.value="";
};

db.collection("produtos").onSnapshot(s=>{
listaProdutos.innerHTML="";
s.forEach(doc=>{
let p=doc.data();
listaProdutos.innerHTML+=`
<tr>
<td>${p.imagem?`<img src="${p.imagem}">`:""}</td>
<td>${p.nome}<br>R$ ${p.preco}<br>${p.categoria}</td>
<td>
<button onclick="editId='${doc.id}';document.getElementById('pNome').value='${p.nome}';document.getElementById('pPreco').value='${p.preco}';document.getElementById('pEstoque').value='${p.estoque||0}';document.getElementById('pCategoria').value='${p.categoria}';mostrar('produtos')" style="background:#16a34a;border:none;padding:5px;color:white;border-radius:6px">Editar</button>
<button onclick="db.collection('produtos').doc('${doc.id}').delete()" style="background:#dc2626;border:none;padding:5px;color:white;border-radius:6px">Excluir</button>
</td>
</tr>
`;
});
});

});
</script>

</body>
</html>
