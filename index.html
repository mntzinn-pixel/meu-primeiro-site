<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eclipseforn</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:#050816;color:white;}
.header{background:rgba(10,15,30,0.9);padding:14px;display:flex;justify-content:center;border-bottom:1px solid rgba(0,255,255,0.3);}
.logo{font-family:'Orbitron',sans-serif;font-size:20px;background:linear-gradient(90deg,#00ffff,#7c3aed,#00ffff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:12px;}
.categoria-titulo{grid-column:1/-1;margin:18px 0 8px;padding:8px 10px;text-align:center;font-family:'Orbitron';font-size:14px;letter-spacing:1.5px;color:#00ffff;position:relative;border-radius:10px;overflow:hidden;background:rgba(0,255,255,0.04);}
.card{background:rgba(255,255,255,0.05);border-radius:14px;overflow:hidden;border:1px solid rgba(0,255,255,0.2);}
.card img{width:100%;height:110px;object-fit:cover;}
.card-content{padding:8px;}
.preco{color:#00ffff;font-weight:700;}
.quantidade-box{display:flex;justify-content:center;align-items:center;gap:8px;margin-top:6px;}
.quantidade-box button{width:26px;height:26px;border:none;border-radius:8px;background:linear-gradient(45deg,#00ffff,#7c3aed);color:white;font-weight:bold;}
.cart-float{position:fixed;bottom:20px;right:20px;background:linear-gradient(45deg,#00ffff,#7c3aed);width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;z-index:999;}
.cart-count{position:absolute;top:-5px;right:-5px;background:red;width:20px;height:20px;font-size:12px;border-radius:50%;display:flex;align-items:center;justify-content:center;}
.cart-modal{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;}
.cart-content{background:#0f172a;width:90%;max-width:400px;padding:20px;border-radius:16px;}
</style>
</head>
<body>

<div class="header">
  <div class="logo">Eclipseforn</div>
</div>

<div class="grid" id="listaProdutos"></div>

<div class="cart-float" onclick="abrirCarrinho()">
  ðŸ›’
  <div class="cart-count" id="cartCount">0</div>
</div>

<div class="cart-modal" id="cartModal">
  <div class="cart-content">
    <div onclick="fecharCarrinho()" style="text-align:right;cursor:pointer;color:#ff4d4d;">Fechar âœ–</div>
    <div id="cartItems"></div>
    <div id="cartTotal" style="margin-top:10px;font-weight:bold;color:#00ffff;"></div>
    <button onclick="finalizarPedido()">Finalizar Pedido</button>
  </div>
</div>

<script>
const firebaseConfig={
  apiKey:"AIzaSyDAnBNdufwLlMW4bZHK0mUgncmIezNSMTg",
  authDomain:"minha-loja-digital1.firebaseapp.com",
  projectId:"minha-loja-digital1"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const numeroWhats="5531993178577";

let carrinho={};
let produtosCache={};

db.collection("produtos").onSnapshot(snapshot=>{
  const container=document.getElementById("listaProdutos");
  container.innerHTML="";
  produtosCache={};
  let categorias={};

  snapshot.forEach(doc=>{
    let p=doc.data();
    produtosCache[doc.id]={...p,id:doc.id};
    let cat=p.categoria||"Outros";
    if(!categorias[cat])categorias[cat]=[];
    categorias[cat].push({...p,id:doc.id});
  });

  Object.keys(categorias).forEach(cat=>{
    container.innerHTML+=`<div class="categoria-titulo">${cat}</div>`;
    categorias[cat].forEach(p=>{
      const semEstoque=(p.estoque!==undefined && p.estoque<=0);
      container.innerHTML+=`
        <div class="card">
          <img src="${p.imagem}">
          <div class="card-content">
            <div>${p.nome}</div>
            <div class="preco">R$ ${p.preco}</div>
            <div style="font-size:11px;color:#ccc;">
              ${semEstoque?'Sem estoque':'Estoque: '+(p.estoque ?? 'âˆž')}
            </div>
            ${!semEstoque?`
              <div class="quantidade-box">
                <button onclick="alterarQtd('${p.id}',-1)">-</button>
                <span id="qtd-${p.id}">1</span>
                <button onclick="alterarQtd('${p.id}',1)">+</button>
              </div>
              <button onclick="adicionarCarrinho('${p.id}')">Adicionar ao Carrinho</button>
            `:`<button disabled style="opacity:0.5;">ESGOTADO</button>`}
          </div>
        </div>`;
    });
  });
});

function alterarQtd(id,valor){
  let el=document.getElementById("qtd-"+id);
  let qtd=parseInt(el.innerText);
  qtd+=valor;
  if(qtd<1)qtd=1;
  el.innerText=qtd;
}

function adicionarCarrinho(id){
  const qtd=parseInt(document.getElementById("qtd-"+id).innerText);
  if(!carrinho[id])carrinho[id]=0;
  carrinho[id]+=qtd;
  atualizarCarrinho();
}

function atualizarCarrinho(){
  let totalItens=0;
  Object.values(carrinho).forEach(q=>totalItens+=q);
  document.getElementById("cartCount").innerText=totalItens;
}

function abrirCarrinho(){
  renderCarrinho();
  document.getElementById("cartModal").style.display="flex";
}

function fecharCarrinho(){
  document.getElementById("cartModal").style.display="none";
}

function renderCarrinho(){
  const container=document.getElementById("cartItems");
  container.innerHTML="";
  let total=0;
  Object.keys(carrinho).forEach(id=>{
    const p=produtosCache[id];
    const qtd=carrinho[id];
    total+=p.preco*qtd;
    container.innerHTML+=`
      <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
        ${p.nome} x${qtd}
        <span>R$ ${(p.preco*qtd).toFixed(2)}</span>
      </div>`;
  });
  document.getElementById("cartTotal").innerText="Total: R$ "+total.toFixed(2);
}

function finalizarPedido(){
  if(Object.keys(carrinho).length===0){alert("Carrinho vazio!");return;}
  let mensagem="OlÃ¡! Quero finalizar meu pedido:%0A%0A";
  let total=0;
  let batch=db.batch();

  Object.keys(carrinho).forEach(id=>{
    const p=produtosCache[id];
    const qtd=carrinho[id];
    total+=p.preco*qtd;
    mensagem+=`- ${p.nome} x${qtd} - R$ ${(p.preco*qtd).toFixed(2)}%0A`;
    if(p.estoque!==undefined){
      batch.update(db.collection("produtos").doc(id),{estoque:p.estoque-qtd});
    }
  });

  mensagem+=`%0ATotal: R$ ${total.toFixed(2)}`;
  batch.commit();

  window.open(`https://wa.me/${numeroWhats}?text=${mensagem}`,"_blank");

  carrinho={};
  atualizarCarrinho();
  fecharCarrinho();
}
</script>

</body>
</html>
