<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eclipseforn</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:#050816;color:white;}

/* HEADER */
.header{
  background:rgba(10,15,30,0.9);
  padding:14px;
  display:flex;
  justify-content:center;
  border-bottom:1px solid rgba(0,255,255,0.3);
}
.logo{
  font-family:'Orbitron',sans-serif;
  font-size:20px;
  background:linear-gradient(90deg,#00ffff,#7c3aed,#00ffff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* GRID */
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:12px;}

/* CATEGORIA */
.categoria-titulo{
  grid-column:1/-1;margin:25px 0 15px;padding:12px;text-align:center;
  font-family:'Orbitron',sans-serif;font-size:18px;letter-spacing:2px;
  color:#00ffff;position:relative;border-radius:12px;overflow:hidden;
  background:rgba(0,255,255,0.05);backdrop-filter:blur(8px);
}
.categoria-titulo::before{
  content:"";position:absolute;inset:0;padding:2px;border-radius:12px;
  background:linear-gradient(90deg,#00ffff,#7c3aed,#00ffff,#7c3aed,#00ffff);
  background-size:300% 300%;animation:bordaAnimada 4s linear infinite;
  -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;mask-composite:exclude;
}
@keyframes bordaAnimada{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

/* CARD */
.card{
  background:rgba(255,255,255,0.05);
  border-radius:14px;overflow:hidden;
  backdrop-filter:blur(12px);
  border:1px solid rgba(0,255,255,0.2);
  transition:0.3s;
}
.card:hover{box-shadow:0 0 15px rgba(0,255,255,0.5);transform:scale(1.03);}
.card img{width:100%;height:110px;object-fit:cover;}
.card-content{padding:8px;}
.preco{color:#00ffff;font-weight:700;}
.card button{
  width:100%;margin-top:6px;padding:6px;border:none;border-radius:16px;
  background:linear-gradient(45deg,#00ffff,#7c3aed);
  color:white;font-size:12px;cursor:pointer;transition:0.3s;
}
.card button:hover{box-shadow:0 0 10px #00ffff;}

/* QUANTIDADE */
.quantidade-box{
  display:flex;align-items:center;justify-content:center;gap:8px;margin-top:6px;
}
.quantidade-box button{
  width:26px;height:26px;border:none;border-radius:8px;
  background:linear-gradient(45deg,#00ffff,#7c3aed);
  color:white;font-weight:bold;cursor:pointer;
}
.quantidade-box span{min-width:20px;text-align:center;font-weight:bold;}

/* NOTIFICAÃ‡ÃƒO */
.notificacao{
  position:fixed;bottom:20px;right:20px;
  background:linear-gradient(45deg,#00ffff,#7c3aed);
  padding:10px 18px;border-radius:12px;
  box-shadow:0 0 15px #00ffff;font-size:13px;z-index:9999;
  animation:fadeIn 0.3s ease;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;}}

/* CARRINHO */
.cart-float{
  position:fixed;bottom:20px;right:20px;
  background:linear-gradient(45deg,#00ffff,#7c3aed);
  width:60px;height:60px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:24px;cursor:pointer;
  box-shadow:0 0 20px rgba(0,255,255,0.6);
  z-index:999;transition:0.3s;
}
.cart-float.animar{transform:scale(1.2);}
.cart-count{
  position:absolute;top:-5px;right:-5px;background:red;
  width:20px;height:20px;font-size:12px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
}
.cart-modal{
  position:fixed;inset:0;background:rgba(0,0,0,0.8);
  display:none;align-items:center;justify-content:center;z-index:1000;
}
.cart-content{
  background:#0f172a;width:90%;max-width:400px;
  padding:20px;border-radius:16px;
  border:1px solid rgba(0,255,255,0.4);
}
.cart-item{
  display:flex;justify-content:space-between;
  margin-bottom:8px;font-size:13px;
}
.total{margin-top:10px;font-weight:bold;color:#00ffff;}
.close-btn{text-align:right;cursor:pointer;margin-bottom:10px;color:#ff4d4d;}
</style>
</head>
<body>

<div class="header">
  <div class="logo">Eclipseforn</div>
</div>

<div class="grid" id="listaProdutos"></div>

<div class="cart-float" id="cartIcon" onclick="abrirCarrinho()">
  ðŸ›’
  <div class="cart-count" id="cartCount">0</div>
</div>

<div class="cart-modal" id="cartModal">
  <div class="cart-content">
    <div class="close-btn" onclick="fecharCarrinho()">Fechar âœ–</div>
    <div id="cartItems"></div>
    <div class="total" id="cartTotal"></div>
    <button onclick="finalizarPedido()">Finalizar Pedido</button>
  </div>
</div>

<script>
const firebaseConfig={
  apiKey:"AIzaSyDAnBNdufwLlMW4bZHK0mUgncmIezNSMTg",
  authDomain:"minha-loja-digital1.firebaseapp.com",
  projectId:"minha-loja-digital1"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const numeroWhats="5531993178577";

let carrinho=[];
let produtosCache={};

function mostrarNotificacao(msg){
  const n=document.createElement("div");
  n.className="notificacao";
  n.innerText=msg;
  document.body.appendChild(n);
  setTimeout(()=>n.remove(),2000);
}

function animarCarrinho(){
  const icon=document.getElementById("cartIcon");
  icon.classList.add("animar");
  setTimeout(()=>icon.classList.remove("animar"),300);
}

db.collection("produtos").onSnapshot(snapshot=>{
  const container=document.getElementById("listaProdutos");
  container.innerHTML="";
  produtosCache={};
  let categorias={};

  snapshot.forEach(doc=>{
    let p=doc.data();
    produtosCache[doc.id]={...p,id:doc.id};
    let cat=p.categoria||"Outros";
    if(!categorias[cat])categorias[cat]=[];
    categorias[cat].push({...p,id:doc.id});
  });

  Object.keys(categorias).forEach(cat=>{
    container.innerHTML+=`<div class="categoria-titulo">${cat}</div>`;
    categorias[cat].forEach(p=>{
      const semEstoque=(p.estoque!==undefined&&p.estoque<=0);

      container.innerHTML+=`
        <div class="card" style="${semEstoque?'opacity:0.6;filter:grayscale(40%);':''}">
          <img src="${p.imagem}">
          <div class="card-content">
            <div>${p.nome}</div>
            <div class="preco">R$ ${p.preco}</div>
            ${p.estoque!==undefined?
              `<div style="font-size:11px;color:#ccc;">
                ${semEstoque?'Sem estoque':'Estoque: '+p.estoque}
              </div>`:''}

            ${!semEstoque?`
              <div class="quantidade-box">
                <button onclick="alterarQtd(this,-1)">-</button>
                <span class="qtd">1</span>
                <button onclick="alterarQtd(this,1)">+</button>
              </div>

              <button onclick="comprarAgora('${p.id}')">Comprar Agora</button>
              <button onclick="adicionarCarrinho('${p.id}',this,${p.estoque||999})">
                Adicionar ao Carrinho
              </button>
            `:`
              <button disabled style="opacity:0.5;">ESGOTADO</button>
            `}
          </div>
        </div>
      `;
    });
  });
});

function alterarQtd(btn,val){
  let span=btn.parentElement.querySelector(".qtd");
  let q=parseInt(span.innerText);
  q+=val;if(q<1)q=1;
  span.innerText=q;
}

function comprarAgora(id){
  const p=produtosCache[id];
  let mensagem=`OlÃ¡! Quero comprar: ${p.nome} - R$ ${p.preco}`;
  window.open(`https://wa.me/${numeroWhats}?text=${encodeURIComponent(mensagem)}`,"_blank");
}

function adicionarCarrinho(id,btn,estoque){
  const qtd=parseInt(btn.parentElement.querySelector(".qtd").innerText);
  if(qtd>estoque){mostrarNotificacao("Quantidade maior que o estoque!");return;}
  for(let i=0;i<qtd;i++)carrinho.push(id);
  atualizarCarrinho();
  animarCarrinho();
  mostrarNotificacao("Produto adicionado!");
}

function atualizarCarrinho(){
  document.getElementById("cartCount").innerText=carrinho.length;
}

function abrirCarrinho(){
  renderCarrinho();
  document.getElementById("cartModal").style.display="flex";
}

function fecharCarrinho(){
  document.getElementById("cartModal").style.display="none";
}

function renderCarrinho(){
  const container=document.getElementById("cartItems");
  container.innerHTML="";
  let total=0;
  carrinho.forEach((id,index)=>{
    const p=produtosCache[id];
    total+=p.preco;
    container.innerHTML+=`
      <div class="cart-item">
        ${p.nome} - R$ ${p.preco}
        <span onclick="removerItem(${index})" style="cursor:pointer;color:red;">âœ–</span>
      </div>`;
  });
  document.getElementById("cartTotal").innerText="Total: R$ "+total.toFixed(2);
}

function removerItem(index){
  carrinho.splice(index,1);
  atualizarCarrinho();
  renderCarrinho();
}

function finalizarPedido(){
  if(carrinho.length===0){alert("Carrinho vazio!");return;}
  let mensagem="OlÃ¡! Quero finalizar meu pedido:%0A%0A";
  let total=0;
  let batch=db.batch();

  carrinho.forEach(id=>{
    const p=produtosCache[id];
    total+=p.preco;
    mensagem+=`- ${p.nome} - R$ ${p.preco}%0A`;
    if(p.estoque!==undefined&&p.estoque>0){
      batch.update(db.collection("produtos").doc(id),{estoque:p.estoque-1});
    }
  });

  mensagem+=`%0ATotal: R$ ${total.toFixed(2)}`;
  batch.commit();
  db.collection("pedidos").add({itens:carrinho,total:total,data:new Date()});
  window.open(`https://wa.me/${numeroWhats}?text=${mensagem}`,"_blank");

  carrinho=[];
  atualizarCarrinho();
  fecharCarrinho();
}
</script>

</body>
</html>
